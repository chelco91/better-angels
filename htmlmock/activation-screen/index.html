<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>MOCKUP - Activation Screen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<style>
#activate-btn {
    padding: 5px;
}
#activate-btn-submit {
    display: block; width: 100%; height: calc(100vh - 10px);
    font-size: 40rem;
}
</style>
</head>
<body>
    <div id="activate-btn"><button id="activate-btn-submit" class="btn btn-danger">&#9764;</button></div>
    <script>
        function geoFindMe () {
            if (!navigator.geolocation){
                if (console && console.error) {
                    console.error('Geolocation is not supported by your browser');
                }
                return;
            }
            navigator.geolocation.getCurrentPosition(
                function (position) { // success callback
                    var latitude  = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    if (console && console.log) {
                        console.log("Lat: " + latitude + "; Long: " + longitude); 
                    }
                    var new_chat = Math.random().toString(36).substring(2); // not "secure," I know
                    var new_url = window.location.protocol
                        + '//' + window.location.host
                        + window.location.pathname.replace('activation-screen/', 'chat-screen/');
                    new_url += '?lat=' + latitude + '&lon=' + longitude
                        + '&chat_room=' + new_chat
                        + '&name=' + getQueryVariable('name');

                    window.open(new_url.replace('chat-screen', 'responder-screen'));
                    window.location.href = new_url + '&show_safety_modal=1';
                },
                function () { // error callback
                    if (console && console.error) {
                        console.error("Unable to retrieve location."); 
                    }
                }
            );
        }
        document.getElementById('activate-btn-submit').addEventListener('click', geoFindMe);
        function getQueryVariable (variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
    </script>
    <noscript>
        <p>This app requires JavaScript to run. :(</p>
    </noscript>
</body>
</html>
